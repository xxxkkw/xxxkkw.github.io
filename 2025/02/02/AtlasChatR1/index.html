<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>AtlasChatR1项目 | xxxkkw的妙妙屋</title><meta name="author" content="xxxkkw"><meta name="copyright" content="xxxkkw"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="DeepSeek R1 1.5B 模型在昇腾 Atlas 200I DK A2 上的推理项目项目基于 DeepSeek 最新的 R1 1.5B 模型，在昇腾 Atlas 200I DK A2 设备上进行推理，并使用 int8 量化,并将模型转换为 OM 模型以便在板上运行。以下是项目简介。  项目简介本项目旨在将 DeepSeek R1 1.5B 模型部署到昇腾 Atlas 200I DK A2"><meta property="og:type" content="article"><meta property="og:title" content="AtlasChatR1项目"><meta property="og:url" content="http://example.com/2025/02/02/AtlasChatR1/index.html"><meta property="og:site_name" content="xxxkkw的妙妙屋"><meta property="og:description" content="DeepSeek R1 1.5B 模型在昇腾 Atlas 200I DK A2 上的推理项目项目基于 DeepSeek 最新的 R1 1.5B 模型，在昇腾 Atlas 200I DK A2 设备上进行推理，并使用 int8 量化,并将模型转换为 OM 模型以便在板上运行。以下是项目简介。  项目简介本项目旨在将 DeepSeek R1 1.5B 模型部署到昇腾 Atlas 200I DK A2"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/head.jpg"><meta property="article:published_time" content="2025-02-01T16:00:00.000Z"><meta property="article:modified_time" content="2025-02-25T13:31:33.176Z"><meta property="article:author" content="xxxkkw"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/head.jpg"><link rel="shortcut icon" href="/img/wall.jpg"><link rel="canonical" href="http://example.com/2025/02/02/AtlasChatR1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>(()=>{const e={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},o&&n[e][o]||(n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n)}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};btf.activateDarkMode=t,btf.activateLightMode=o;const a=e.get("theme");"dark"===a?t():"light"===a&&o();const n=e.get("aside-status");void 0!==n&&document.documentElement.classList.toggle("hide-aside","hide"===n);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"AtlasChatR1项目",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-02-25 21:31:33"}</script><link rel="stylesheet" href="/styles/main.css"><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{const d=document.getElementById("loading-box"),e=document.body,o=()=>{e.style.overflow="",d.classList.add("loaded")},l=()=>{e.style.overflow="hidden",d.classList.remove("loaded")};l(),window.addEventListener("load",o)})()</script><div id="web_bg" style="background-color:#efefef"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/head.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/wall.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">xxxkkw的妙妙屋</span></a><a class="nav-page-title" href="/"><span class="site-name">AtlasChatR1项目</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">AtlasChatR1项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-01T16:00:00.000Z" title="发表于 2025-02-02 00:00:00">2025-02-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-02-25T13:31:33.176Z" title="更新于 2025-02-25 21:31:33">2025-02-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python/">python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python/Ascend/">Ascend</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/02/02/AtlasChatR1/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2025/02/02/AtlasChatR1/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="DeepSeek-R1-1-5B-模型在昇腾-Atlas-200I-DK-A2-上的推理项目"><a href="#DeepSeek-R1-1-5B-模型在昇腾-Atlas-200I-DK-A2-上的推理项目" class="headerlink" title="DeepSeek R1 1.5B 模型在昇腾 Atlas 200I DK A2 上的推理项目"></a>DeepSeek R1 1.5B 模型在昇腾 Atlas 200I DK A2 上的推理项目</h1><p>项目基于 DeepSeek 最新的 R1 1.5B 模型，在昇腾 Atlas 200I DK A2 设备上进行推理，并使用 int8 量化,并将模型转换为 OM 模型以便在板上运行。以下是项目简介。</p><hr><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>本项目旨在将 DeepSeek R1 1.5B 模型部署到昇腾 Atlas 200I DK A2 设备上，通过 int8 量化优化模型推理性能。项目包含以下主要功能：</p><ol><li><strong>模型导出</strong>：将 DeepSeek R1 1.5B 模型导出为 ONNX 格式。</li><li><strong>模型量化</strong>：将 ONNX 模型量化为 int8 格式。</li><li><strong>模型推理与测评</strong>：在 Atlas 200I DK A2 设备上运行推理，并测评模型的推理速度和显存占用。</li></ol><hr><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><h2><a href="#" class="headerlink"></a><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DeepSeek-Atlas-Chat/</span><br><span class="line">├── export.py # 将 DeepSeek R1 模型导出为 ONNX 格式</span><br><span class="line">├── quant.py # 将 ONNX 模型量化为 int8 格式</span><br><span class="line">├── eval.py # 测评模型推理速度和显存占用</span><br><span class="line">├── onnx_model_output/ # 存放从原始 R1 模型导出的 ONNX 模型</span><br><span class="line">├── deepseek_quant8.onnx # 自动生成的 int8 量化后的 ONNX 模型</span><br><span class="line">└── README.md # 项目说明文档</span><br></pre></td></tr></table></figure></h2><h2 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h2><ul><li><strong>硬件</strong>：昇腾 Atlas 200I DK A2，理论上也可以在其他310B设备运行</li><li><strong>软件</strong>：<ul><li>Python 3.9 或更高版本</li><li>ONNX 1.10.0 或更高版本</li><li>昇腾 CANN 工具包（推荐版本 8.0.0RC3）</li><li>PyTorch 2.0.0 及以上</li><li>ONNX Runtime（可选，用于本地测试）</li></ul></li></ul><hr><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="1-请先自行下载DeepSeek-R1-Distill-Qwen-1-5B模型"><a href="#1-请先自行下载DeepSeek-R1-Distill-Qwen-1-5B模型" class="headerlink" title="1. 请先自行下载DeepSeek-R1-Distill-Qwen-1.5B模型"></a>1. 请先自行下载DeepSeek-R1-Distill-Qwen-1.5B模型</h3><h3 id="2-导出-ONNX-模型"><a href="#2-导出-ONNX-模型" class="headerlink" title="2. 导出 ONNX 模型"></a>2. 导出 ONNX 模型</h3><p>运行 <code>export.py</code> 脚本，将 DeepSeek R1 1.5B 模型导出为 ONNX 格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python export.py -m /path/to/DeepSeek-R1-Distill-Qwen-1.5B</span><br></pre></td></tr></table></figure><p>若设备支持cuda或者mps，可在运行时加上<code>-d cuda</code>或者<code>-d mps</code></p><h3 id="3-量化-ONNX-模型为-int8-格式"><a href="#3-量化-ONNX-模型为-int8-格式" class="headerlink" title="3. 量化 ONNX 模型为 int8 格式"></a>3. 量化 ONNX 模型为 int8 格式</h3><p>运行 quant.py 脚本，将 ONNX 模型量化为 int8 格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python quant.py</span><br></pre></td></tr></table></figure><p>量化后的模型将保存为 <code>deepseek_quant8.onnx</code></p><h3 id="4-测评模型推理性能"><a href="#4-测评模型推理性能" class="headerlink" title="4. 测评模型推理性能"></a>4. 测评模型推理性能</h3><p>运行 eval.py 脚本，测评模型在 转换量化前后的推理速度：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python eval.py</span><br></pre></td></tr></table></figure><br>得到结果大致如下，设备性能不同可能得到不同的结果，结果符合从fp32到int8的性能提升<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">测试 PyTorch 模型...</span><br><span class="line">PyTorch 模型平均推理时间: 0.2651 秒</span><br><span class="line">PyTorch 模型每秒处理 token 数量: 37.72 tokens/s</span><br><span class="line"></span><br><span class="line">测试 ONNX 模型...</span><br><span class="line">ONNX 模型平均推理时间: 0.0611 秒</span><br><span class="line">ONNX 模型每秒处理 token 数量: 163.77 tokens/s</span><br><span class="line"></span><br><span class="line">ONNX 模型相较于 PyTorch 模型推理速度提升: 4.34 倍</span><br></pre></td></tr></table></figure><p></p><h3 id="5-部署算子"><a href="#5-部署算子" class="headerlink" title="5. 部署算子"></a>5. 部署算子</h3><p>因为<code>cann</code>的算子清单中没有<code>MatMulIntegar</code>,<code>DynamicQuantizeLinear</code>,<code>DequantizeLinear</code>算子，所以就需要自己将算子补上，否则atc工具无法转换成om模型，后续的推理也无法正常运行<br>首先安装<code>protoc</code>，这是算子部署build.sh需要的<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装protoc==1.13.0, 找一空闲目录下载</span></span><br><span class="line">wget  https://obs-9be7.obs.cn-east-2.myhuaweicloud.com/wanzutao/tiny-llama/protobuf-all-3.13.0.tar.gz</span><br><span class="line">tar -zxvf protobuf-all-3.13.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> protobuf-3.13.0</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install autoconf automake libtool</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure</span><br><span class="line">make -j4</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">sudo</span> ldconfig</span><br><span class="line">protoc --version <span class="comment"># 查看版本号</span></span><br></pre></td></tr></table></figure><p></p><p>随后部署算子<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> matmul_integer_plugin.cc /usr/local/Ascend/ascend-toolkit/latest/tools/msopgen/template/custom_operator_sample/DSL/Onnx/framework/onnx_plugin/</span><br><span class="line"><span class="built_in">cp</span> dynamic_quantize_linear_plugin.cc /usr/local/Ascend/ascend-toolkit/latest/tools/msopgen/template/custom_operator_sample/DSL/Onnx/framework/onnx_plugin/</span><br><span class="line"><span class="built_in">cp</span> dequantize_linear_plugin.cc /usr/local/Ascend/ascend-toolkit/latest/tools/msopgen/template/custom_operator_sample/DSL/Onnx/framework/onnx_plugin/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/Ascend/ascend-toolkit/latest/tools/msopgen/template/custom_operator_sample/DSL/Onnx </span><br></pre></td></tr></table></figure><br>打开<code>build.sh</code>，添加如下四个环境变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ASCEND_TENSOR_COMPILER_INCLUDE=/usr/local/Ascend/ascend-toolkit/latest/include</span><br><span class="line"><span class="built_in">export</span> TOOLCHAIN_DIR=/usr</span><br><span class="line"><span class="built_in">export</span> AICPU_KERNEL_TARGET=cust_aicpu_kernels</span><br><span class="line"><span class="built_in">export</span> AICPU_SOC_VERSION=Ascend310B4</span><br></pre></td></tr></table></figure><br>编译部署算子<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./build.sh </span><br><span class="line"><span class="built_in">cd</span> build_out/</span><br><span class="line">./custom_opp_ubuntu_aarch64.run</span><br></pre></td></tr></table></figure><p></p><h3 id="6-转换-ONNX-模型为-OM-模型"><a href="#6-转换-ONNX-模型为-OM-模型" class="headerlink" title="6. 转换 ONNX 模型为 OM 模型"></a>6. 转换 ONNX 模型为 OM 模型</h3><p>使用昇腾 ATC 工具将量化后的 ONNX 模型转换为 OM 模型：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">atc --model=/root/AtlasChatR1/modified_model.onnx \</span><br><span class="line">    --framework=5 \</span><br><span class="line">    --output=deepseek_om_model \</span><br><span class="line">    --input_format=ND \</span><br><span class="line">    --input_shape=<span class="string">&quot;input_ids:-1,-1;attention_mask:-1,-1&quot;</span> \</span><br><span class="line">    --dynamic_dims=<span class="string">&quot;1,64,1,64;8,128,8,128;16,256,16,256&quot;</span> \</span><br><span class="line">    --soc_version=Ascend310B4 \</span><br><span class="line">    --precision_mode=allow_fp32_to_fp16</span><br></pre></td></tr></table></figure><br>这一步的时间会很长，耐心等待<p></p></article><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/head.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2025/02/19/EagleEyes/" title="鹰眼项目重构"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">鹰眼项目重构</div></div></a><a class="next-post pull-right" href="/2024/12/23/AI-Mario/" title="AI-Mario项目"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">AI-Mario项目</div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/head.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">xxxkkw</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxkkw"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">我的小站</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DeepSeek-R1-1-5B-%E6%A8%A1%E5%9E%8B%E5%9C%A8%E6%98%87%E8%85%BE-Atlas-200I-DK-A2-%E4%B8%8A%E7%9A%84%E6%8E%A8%E7%90%86%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">DeepSeek R1 1.5B 模型在昇腾 Atlas 200I DK A2 上的推理项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">项目简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.3.</span> <span class="toc-text">1234567DeepSeek-Atlas-Chat&#x2F;├── export.py # 将 DeepSeek R1 模型导出为 ONNX 格式├── quant.py # 将 ONNX 模型量化为 int8 格式├── eval.py # 测评模型推理速度和显存占用├── onnx_model_output&#x2F; # 存放从原始 R1 模型导出的 ONNX 模型├── deepseek_quant8.onnx # 自动生成的 int8 量化后的 ONNX 模型└── README.md # 项目说明文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82"><span class="toc-number">1.4.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.5.</span> <span class="toc-text">使用步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AF%B7%E5%85%88%E8%87%AA%E8%A1%8C%E4%B8%8B%E8%BD%BDDeepSeek-R1-Distill-Qwen-1-5B%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. 请先自行下载DeepSeek-R1-Distill-Qwen-1.5B模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AF%BC%E5%87%BA-ONNX-%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 导出 ONNX 模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%87%8F%E5%8C%96-ONNX-%E6%A8%A1%E5%9E%8B%E4%B8%BA-int8-%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. 量化 ONNX 模型为 int8 格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%84%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E6%80%A7%E8%83%BD"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. 测评模型推理性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%83%A8%E7%BD%B2%E7%AE%97%E5%AD%90"><span class="toc-number">1.5.5.</span> <span class="toc-text">5. 部署算子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E8%BD%AC%E6%8D%A2-ONNX-%E6%A8%A1%E5%9E%8B%E4%B8%BA-OM-%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.5.6.</span> <span class="toc-text">6. 转换 ONNX 模型为 OM 模型</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/02/%E5%96%89%E9%95%9C%E7%BB%93%E6%9E%84%E8%A7%82%E6%B5%8B%E6%B1%87%E6%8A%A5/" title="喉镜结构观测汇报">喉镜结构观测汇报</a><time datetime="2025-11-02T14:00:00.000Z" title="发表于 2025-11-02 22:00:00">2025-11-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/31/%E6%A1%86%E5%9B%BE%E6%95%99%E5%AD%A6%E5%90%91/" title="框图教学向">框图教学向</a><time datetime="2025-10-30T16:00:00.000Z" title="发表于 2025-10-31 00:00:00">2025-10-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/12/%E5%96%89%E9%95%9C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" title="喉镜数据分析">喉镜数据分析</a><time datetime="2025-10-12T11:00:00.000Z" title="发表于 2025-10-12 19:00:00">2025-10-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/05/%E6%9C%8D%E5%8A%A1%E5%99%A8SMB%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%8C%87%E5%8D%97/" title="服务器SMB文件共享指南">服务器SMB文件共享指南</a><time datetime="2025-10-04T16:00:00.000Z" title="发表于 2025-10-05 00:00:00">2025-10-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/20/%E9%A1%B9%E7%9B%AE%E6%B1%87%E6%8A%A57.0/" title="项目汇报7.0">项目汇报7.0</a><time datetime="2025-09-20T08:00:00.000Z" title="发表于 2025-09-20 16:00:00">2025-09-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By xxxkkw</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{new Valine(Object.assign({el:"#vcomment",appId:"NuwmhVS9BmgOpiVJWroZWSWW-gzGzoHsz",appKey:"NJWb1pCdV9rcU5odlHizyxsJ",avatar:"monsterid",serverURLs:"",emojiMaps:"",path:window.location.pathname,visitor:!1},null))},e=async()=>{"function"==typeof Valine||await btf.getScript("https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"),t()};setTimeout(e,0)})()</script></div></div></body></html>